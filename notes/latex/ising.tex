\documentclass{amsart}
\usepackage[tmargin=1in, bmargin=1in, lmargin=0.8in, rmargin=1in]{geometry}
%%% Sets numbering depth to subsection level (e.g, no numbered subsubsections)
\setcounter{secnumdepth}{2}

% include notes style file from Abhishek Shivkumar
\usepackage{macrosabound, theorem-env}

% make font smaller
\usepackage[fontsize=10pt]{fontsize}%%% Coloring the comment as blue

% algorithms
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\newcommand\mycommfont[1]{\footnotesize\ttfamily\textcolor{blue}{#1}}
\SetCommentSty{mycommfont}
\SetKwInput{KwInput}{Input}                % Set the Input
\SetKwInput{KwOutput}{Output}              % set the Output

%%%%%%%%%%%%%%%%%%
%%%% FOR DEBUGGING
%%%%%%%%%%%%%%%%%%
%\usepackage{layout}
%\usepackage{showframe}

%%% Removes paragraph indentation and changes paragraph line skip

% ensures that the references show up as an unnumbered section
\def\bibsection{\section*{\refname}} 
\begin{document}
%%% The Title and Author only need to be set once at the start of the document. If you take notes for multiple courses in the same document (for example, in a multi-semester sequence for the same course), you can separate the courses with a new Part, and the semester, lecturer, and course only need to be set once at the start of the new course.
\newpage
\title{The Reverse Ising Problem}
\author{Isaac Martin}
\date{Summer 2023}
\maketitle
\tableofcontents
\section{Foundations}

Throughout this document we set $\Sigma = \{-1,1\}$ to be the set of possible spins ($\Sigma$ for \textbf{s}pin) taken by a single vertex in an Ising graph. For any set $G$, we denote by $\Sigma^G$ the set of all functions $\sigma: G\to \Sigma$.

\begin{defn}\label{defn:ising-circuit}
  An \textbf{Ising circuit} is a tuple $(G, N, M, f_G)$ where
  \begin{itemize}
    \item $G$ is a set
    \item $N, M \subseteq G$
    \item $f_G: \Sigma^N \to \Sigma^M$ is an arbitrary function called the \emph{logic} function.
  \end{itemize}
  Additionally, 
\end{defn}

\subsection{Partial Ising Circuits}

\begin{defn}\label{defn:ising-subcircuit}
  As always, let $\Sigma = \{-1,+1\}$ and let $(G,f)$ be an Ising circuit with $G = N \cup M$. An \textbf{Ising subcircuit} of $(G,f)$ is some pair $(G', f')$ such that $G' = N\cup M'$ with $M' \subset M$ and $f'$ agrees with $f$ on the $M'$ coordinates; i.e. there is some function $g:\Sigma^N \to \Sigma^{M \setminus M'}$ such that $f = f'\times g$.
\end{defn}

\begin{defn}\label{defn:partial-ising}
  Let $\Sigma = \{-1, +1\}$ and let $(G,f)$ be an Ising circuit with further decompositions of the output space into $M = M_1 \cup M_2$ and the logic into $f = f_1\times f_2$. We say that $(G,f)$ is \emph{partially} solvable with respect to $M_2$ if there exists some Hamiltonian such that
  \begin{align*}
    (s,f_1(s),f_2(s)) < (s,f_1(s),t)
  \end{align*}
  for all $s \in \Sigma^N$ and $f_2(s) \neq t \in \Sigma^{M_2}$.
\end{defn}

\begin{prop}\label{prop:partial_solvability}
  Let $(G,f)$ be an Ising circuit with subcircuit $(N\cup M_1, f_1)$, and set $M_2 = M \setminus M_1$ . If the subcircuit $(G_1 = N\cup M_1, f_1)$ is solvable and $(G,f)$ is partially solvable with respect to $M_2$ then $(G,f)$ is solvable.
\end{prop}
\begin{proof}
    Suppose $(G_1,f_1)$ is solvable with Hamiltonian $H_1$ and $(G,f)$ is partially solvable by Hamiltonian $H_2$. By definition this means
    \begin{align*}
        H_1(s,f_1(s)) < H_1(s,r) \hspace{1em} \text{for all } s\in \Sigma^N \text{ and } f_1(s) \neq r \in \Sigma^{M_1}
    \end{align*}
    and
    \begin{align*}
        H_2(s,f_1(s),f_2(s)) < H_2(s,f_1(s), t) \hspace{1em} \text{for all } s\in \Sigma^N \text{ and } f_2(s) \neq t \in \Sigma^{M_2}.
    \end{align*}
    Define $H_\lambda(s,r,t) = H_2(s,r,t) + \lambda H_1(s,r)$. By definition, $H_\lambda$ is a Hamiltonian which solves $(G,f)$ if and only if for all $(r,t) \neq (f_1(s), f_2(s))$,
    \begin{align*}
        H_\lambda(s,r,t) > H_\lambda(s,f_1(s),f_2(s))
        &\iff H_\lambda(s,r,t) - H_\lambda(s,f_1(s),f_2(s)) > 0\\
        &\iff H_2(s,r,t) - H_2(s,f_1(s),f_2(s)) + \lambda(H_1(s,r) - H_1(s,f_1(r))) > 0 \\
        &\iff H_2(s,r,t) - H_2(s,f_1(s),f_2(s)) > \lambda(H_1(s,f_1(r)) - H_1(s,r)).
    \end{align*}
    Set $\alpha = \max_{s,r}(H_1(s,f_1(s)) - H_1(s,r))$ and $\beta = \min_{s,r,t} (H_2(s,r,t) - H_2(s,f_1(s),f_2(s)))$. Then any choice of $\lambda$ such that $\beta > \lambda\alpha$ will ensure the above inequality is satisfied for all $s$, $r\neq f_1(s)$ and $t\neq f_2(x)$.
\end{proof}

\begin{rmk}
    The converse of Proposition \ref{prop:partial_solvability} is false; solvability of $(G,f)$ does not necessarily imply the solvability of its subcircuits.
\end{rmk}
\begin{rmk}
    Decomposing an Ising circuit $G$ into $G_1 = N \cup M_1$ and $G_2 = N \cup M_2$ seems dual to the addition of auxiliary spins $A$ to circuit $G_1 = N \cup M_1$, however, the two processes are distinct in a subtle way. Solving an Ising circuit $G$ through the addition of auxiliary spins $A$ and an auxiliary array $g:\Sigma^N \to \Sigma^A$ results in a constraint set
    \begin{align*}
        (s,f(s),g(s)) < (s,t,a) ~\text{ for all }~ s\in \Sigma^N ~\text{ and }~ f(s) \neq t\in \Sigma^M,
    \end{align*}
    for a total of $2^N(2^{M+A} - 2^A)$ constraints. However, solving $G = N \cup M_1 \cup M_2$ requires satisfying the constraints
    \begin{align*}
        (s,f_1(s),f_2(s)) < (s,r,t) ~\text{ for all }~ s\in \Sigma^N ~\text{ and }~ (f_1(s), f_2(s)) \neq (r,t) \in \Sigma^{M_1}\times \Sigma^{M_2},
    \end{align*}
    for a total of $2^N(2^{M_1 + M_2} - 1)$ constraints. \textbf{Circuits with auxiliaries care only about correctness in the output component, whereas circuits with decomposed output spaces require correctness in all output components. Auxiliary spins are therefore not the same as output spins.}
\end{rmk}

These remarks notwithstanding, Proposition \ref{prop:partial_solvability} is a powerful tool for solving Ising circuits. For instance, suppose we have an algorithm PartialSolve which takes as input $(G,M_2)$ where
\begin{itemize}
  \item $G = N\cup M_1 \cup M_2$ is an ising circuit
  \item $(G,M_1)$ is a solvable subcircuit
\end{itemize}
and returns an Ising circuit $G'$ which is partially solvable with respect to $M_2$. Such an algorithm can be achieved using an auxiliary solve, for instance. We can then solve \emph{any} Ising circuit by
\begin{algorithm}[!ht]
\DontPrintSemicolon
  
  \KwInput{Ising Circuit $(G=N\cup M, f)$ with decomposition $M = M_1 \cup ...\cup M_k$.}
  \KwOutput{Ising circuit $G' = G \cup A$ solving $G$ with auxiliary spins $A$.}
    $i = 1$
    $G' = N\cup M_i$.

  \While{$i \neq k$}
  {
     $i = i + 1$

    $G' = G' \cup M_i$

    $G' = \text{PartialSolve}(G')$
  }
\caption{RecursivePartialSolve}
\end{algorithm}

Since $G'$ is always solvable, the full circuit $G$ (together with the auxiliary spins accrued by the solves of $G'$) is solvable if and only if $G'$ is solvable with respect to $M_{i+1} \cup ... \cup M_k$, due to Proposition \ref{prop:partial_solvability}. By the time RecursivePartialSolve terminates, $G'$ will be a solution to $G$ with auxiliaries.

The advantage of using this algorithm over an auxiliary solve is that each iteration of $PartialSolve$ only has to operate over $|2^N\times (2^{M_2} - 1)|$ many constraints.



\section{Boolean Ising Circuits}
In this section we consider Ising circuits $(G,f)$ with only one output. This special case proves tractable enough to produce useful theoretical results, and yet general enough to yield good solutions to the general case.

\begin{prop}\label{prop:boolean-ising-svm-equiv}
  
\end{prop}
\section{Hierarchical Clustering}

A choice of ``auxililary array'' can be thought of as a function $a:\Sigma^N \to \Sigma^A$ which assigns an auxiliary state to each input state. The collection of germs of this function partitions $\Sigma^N$ into subsets of inputs which share the same auxiliary state. To be clear, we're talking about the partition
\begin{align*}
  \{a^{-1}(\alpha)\}_{\alpha \in \Sigma^A}
\end{align*}
of input spin space. If the choice of auxiliary array $a$ makes the Ising circuit feasible, then we say $a$ solves the Ising circuit.

This simple observation motivates a simple question: \emph{can a partition of $\Sigma^N$ be found such that it matches the partition produced by some feasible auxiliary array using only the logic of the Ising circuit?} Producing such a partition is a clustering problem on input spinspace.

\section{Pseudo-boolean optimization and polynomial fitting}
A pseudo boolean function (PBF) is any function $f:\{0,1\}\to \bR$. It is a well known fact that any such PBF can be uniquely represented by a multilinear polynomial in $n$ variables [pseudo-boolean optimization Boros, Hammer]; that is, a polynomial
\begin{align*}
  g(x_1,...,x_n) = \sum_{S \subset [n]} a_S \prod_{j \in S}x_j
\end{align*}
with $a_S \in \bR$ which equals $f$ pointwise on $\{0,1\}^n$. To be clear, here $S$ iterates over all subsets of $[n] = \{1,...,n\}$.

It is another well-known fact that the optimization of any pseudo-boolean function can be reduced in polynomial time to an optimization problem on a quadratic polynomial. The original method for accomplishing this was first written by Rosenberg, and since then a reputable zoo of alternative algorithms have been introduced. Most methods share the same basic idea: reduce degree $\geq 3$ monomial terms appearing in the polynomial $g$ by introducing auxiliary variables subject to constraints.

<copy Rosenberg algorithm from Boros, Hammer pg 168>

\begin{thm}\label{thm:rosenberg-reduction}
  Let $f$ be a multilinear polynomial in $n$ variables. There exists an algorithm $\textsc{Reduce}$ which produces a multilinear polynomial $g$ in $n + a$ variables such that
  \begin{align*}
    \min_{(\bfx, \bfa) \in \bB^n \times \bB^a} g(\bfx, \bfa) = \min_{\bfx \in \bB^n} f(\bfx)
  \end{align*}
  and if $(\bfx, \bfa) = \arg\min_{(\bfx, \bfa) \in \bB^n \times \bB^a} g(\bfx, \bfa)$ then $\bfx = \arg\min_{\bfx \in \bB^n} f(\bfx).$
\end{thm}
\begin{proof}
  [Boros Hammer Pseudo Boolean Optimization 2002]
\end{proof}
We need a slightly stronger statement however.
\begin{thm}
  Let $f:\Sigma^N \to \Sigma^M$ be a circuit. Then there exists an Ising circuit with auxiliary spins given by Hamiltonian $H$ which solves $f$.
\end{thm}
\begin{proof}
  Fix $G = N \cup M$ and consider the hamming objective function $\operatorname{ham}:\Sigma^N\times \Sigma^M\to \bR$ defined
  \begin{align*}
    \operatorname{ham}(s,t) = d(t, f(s))
  \end{align*}
  where $d(t, f(s))$ is the Hamming distance between $t$ and the correct output $f(s)$. Then there exists some multilinear polynomial $g$ in $|G|$ variables which recovers $\operatorname{ham}$ pointwise. We now apply Rosenberg reduction to $g$ and set $H$ equal to the terminal quadratic polynomial we obtain. All that remains to show is that on any input level $s$ the output which minimizes $H$ is $f(s)$.

  Fix an input $s$ and suppose that the minimizer of $g^k(s, \cdot)$ has output coordinates $f(s)$. To obtain $g^{k+1}$ we replace some pair $x_ix_j$ by $x_{k+1}$ and add the expression $M(x_ix_j - 2x_ix_{k+1} - 2x_jx_{k+1} + 3x_{k+1})$. Observe that this expression is zero if $x_ix_j = x_{k+1}$ and is strictly positive otherwise. It follows that $g^k(\bfx) = g^{k+1}(\bfx, x_{k+1})$ if $x_{k+1} = x_ix_j$ and $g^k(\bfx) < g^{k+1}(\bfx, x_{k+1})$ if $x_{k+1} \neq x_ix_j$. Hence the minimizer of $g^{k+1}$ on input level $s$ also has the correct output coordinates, and inductively, we conclude that $H$ is an Ising Hamiltonian reproducing the circuit $f$.
\end{proof}
\newpage
\bibliographystyle{abbrvnat}
\bibliography{ising}
\end{document}
